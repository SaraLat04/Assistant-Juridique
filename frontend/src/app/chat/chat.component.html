<div class="chat-layout" [class.dark-theme]="isDark" [class.light-theme]="!isDark">
  <!-- Sidebar / Historique -->
  <div class="sidebar" [class.sidebar-closed]="!isSidebarOpen">
    <div class="sidebar-header">
      <h2>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        Assistant Juridique
      </h2>
    </div>
  <app-historique #hist (selectConversation)="onConversationSelected($event)"></app-historique>
  </div>

  <!-- Toggle Button -->
  <button class="sidebar-toggle" (click)="toggleSidebar()" [class.toggle-moved]="!isSidebarOpen">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline [attr.points]="isSidebarOpen ? '15 18 9 12 15 6' : '9 18 15 12 9 6'"></polyline>
    </svg>
  </button>

  <!-- Main Chat Area -->
  <div class="chat-main" [class.chat-expanded]="!isSidebarOpen">
    <div class="chat-header">
      <div class="header-content">
        <div class="header-icon">
          <img src="assets/logo-al-mohami.png" alt="AL MOHAMI" class="header-logo" />
        </div>
        <div class="header-text">
          <h1>Assistant Juridique IA</h1>
          <p>Posez vos questions juridiques en toute confiance</p>
        </div>
        <div class="header-actions">
          <button class="theme-toggle-header" (click)="toggleTheme()" aria-label="Basculer le thème">
            <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="4"></circle>
              <path d="M12 2v2m0 16v2m10-10h-2M4 12H2m15.364 6.364-1.414-1.414M8.05 8.05 6.636 6.636m10.728 0-1.414 1.414M8.05 15.95 6.636 17.364"></path>
            </svg>
            <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79Z"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Messages Container -->
    <div class="messages-container" [class.empty-state]="messages.length === 0">
      <!-- Empty State -->
      <div *ngIf="messages.length === 0" class="welcome-message">
        <div class="welcome-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
        </div>
        <h2>Bienvenue sur votre Assistant Juridique</h2>
        <p>Posez une question pour commencer une consultation</p>
        <div class="suggestions">
          <div class="suggestion-card" (click)="question = 'Quels sont les droits du locataire en cas de litige ?'">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            Droits du locataire
          </div>
          <div class="suggestion-card" (click)="question = 'Comment rédiger un contrat de travail conforme ?'">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
            Contrat de travail
          </div>
          <div class="suggestion-card" (click)="question = 'Procédure pour créer une société ?'">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
              <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
            </svg>
            Création d'entreprise
          </div>
        </div>
      </div>

      <!-- Messages List -->
      <div *ngIf="messages.length > 0" class="messages-list">
        <div *ngFor="let msg of messages; let i = index"
             class="message-wrapper"
             [class.message-user]="msg.type === 'user'"
             [class.message-bot]="msg.type === 'bot'">
          <div class="message-avatar">
            <svg *ngIf="msg.type === 'user'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <svg *ngIf="msg.type === 'bot'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 8V4H8"></path>
              <rect x="2" y="8" width="20" height="12" rx="2"></rect>
              <path d="M6 16h.01"></path>
              <path d="M10 16h.01"></path>
              <path d="M14 16h.01"></path>
              <path d="M18 16h.01"></path>
            </svg>
          </div>
          <div class="message-content">
            <div class="message-header">
              <span class="message-sender">{{ msg.type === 'user' ? 'Vous' : 'Assistant Juridique' }}</span>
              <span class="message-time">{{ msg.timestamp | date:'HH:mm' }}</span>
            </div>
            <div class="message-text">{{ msg.text }}</div>
          </div>
        </div>

        <!-- Loading Indicator -->
        <div *ngIf="isLoading" class="message-wrapper message-bot">
          <div class="message-avatar">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 8V4H8"></path>
              <rect x="2" y="8" width="20" height="12" rx="2"></rect>
              <path d="M6 16h.01"></path>
              <path d="M10 16h.01"></path>
              <path d="M14 16h.01"></path>
              <path d="M18 16h.01"></path>
            </svg>
          </div>
          <div class="message-content">
            <div class="message-header">
              <span class="message-sender">Assistant Juridique</span>
            </div>
            <div class="typing-indicator">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="input-area">
      <div class="input-container">
        <textarea
          [(ngModel)]="question"
          (keypress)="onKeyPress($event)"
          placeholder="Posez votre question juridique..."
          rows="1"
          [disabled]="isLoading"></textarea>
        <button
          class="send-button"
          (click)="sendQuestion()"
          [disabled]="!question.trim() || isLoading"
          [class.button-active]="question.trim()">
          <svg *ngIf="!isLoading" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
          <svg *ngIf="isLoading" class="spinner" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="2" x2="12" y2="6"></line>
            <line x1="12" y1="18" x2="12" y2="22"></line>
            <line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line>
            <line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line>
            <line x1="2" y1="12" x2="6" y2="12"></line>
            <line x1="18" y1="12" x2="22" y2="12"></line>
            <line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line>
            <line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line>
          </svg>
        </button>
      </div>
      <p class="input-disclaimer">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="16" x2="12" y2="12"></line>
          <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>
        Les réponses sont fournies à titre informatif. Consultez un avocat pour des conseils personnalisés.
      </p>
    </div>
  </div>
</div>
